# JS

## 内置类型

JS中内置的类型有两种：**基本类型**和**引用类型**。

- 基本类型：Undefined、Null、Boolean、Number、String和symbol。这6种基本数据类型是按值访问的，因为可以操作保存在变量中的实际值。
- 引用类型：Object。引用类型的值的值是保存在内存中的对象。而Js是不允许直接访问内存中的位置，也就是说不能直接操作对象的内存空间。操作对象时，实际上是操作对象的引用而非实际对象。

### 动态的属性

只能给引用类型值动态地添加属性。

```js
// 引用类型
var person = new Object();
person.name = "Max";
console.log(person.name);    // "Max"

// 基本类型
var name = "Max";
name.age = 27;
console.log(name.age);      // Undefined 
```

### 复制变量值

从一个变量向另一个变量复制基本类型值和引用类型值时，也存在不同。

- 首先我们来看基本类型值的情况，在下面的例子里，num1保存的值是5，用num1的值初始化num2时，num2也保存了值5，但是num2中的5跟num1中的5是完全独立的，该值只是num1中5的一个副本。此后，两个变量参与任何操作都不会相互影响。

```js
var num1 = 5;
var num2 = num1;
```

- 接着我们来看引用类型值的情况，从下面例子我们可以看出，如果用obj1去初始化obj2的时候，修改obj1的属性时，同样会影响到obj2。
首先，obj1保存了一个对象实例，然后用obj1的值赋给obj2时，其实这里跟基本类型值一样也会复制一个副本分配到空间中，但是不同的是，这个值的副本实际上是一个指针，指向存储在堆中的一个对象。复制操作结束后，两个变量实际上引用的是同一个对象。因此改变一个变量，就会影响另一个变量。

```js
var obj1 = new Object();
var obj2 = obj1;
obj1.name = "Max";
console.log(obj2.name);    // "Max"
```

## 类型转换

### 转Boolean

在条件判断时，除了以下7个falsy值：`undefined`、`null`、`false`、`NaN`、`''`、`0`和`-0`以外，其他所有值都转为`true`，包括所有对象。

### 对象转基本类型

对象在转换基本类型时，首先会调用`valueOf`然后调用`toString`。并且这两个方法你是可以重写的。

```js
let a = {
  valueOf() {
    return 0
  }
};
```

当然你也可以重写`Symbol.toPrimitive`，该方法在转基本类型时调用优先级最高。

```js
let a = {
  valueOf() {
    return 0;
  },
  toString() {
    return '1';
  },
  [Symbol.toPrimitive]() {
    return 2;
  }
}
1 + a // 3
'1' + a // '12'
```

### 四则运算符

- 遇到`-` 、`*` 、`/` 和 `%`这四个运算符的时候，会在运算之前将参与运算的双方转换成数字。

- 只有遇到`+`时，其中一方是字符串类型，就会把另一个也转为字符串类型。其他运算只要其中一方是数字，那么另一方就转为数字。并且加法运算会触发三种类型转换：将值转换为原始值，转换为数字，转换为字符串。

```js
1 + '1' // '11'
2 * '2' // 4
[1, 2] + [2, 1] // '1,22,1'
// [1, 2].toString() -> '1,2'
// [2, 1].toString() -> '2,1'
// '1,2' + '2,1' = '1,22,1'
```

对于加号需要注意这个表达式 `'a' + + 'b'`

```js
'a' + + 'b' // "aNaN"
// 因为 + 'b' -> NaN
// 你也许在一些代码中看到过 + '1' -> 1
```

### `==`操作符

![==操作符](../.vuepress/assets/img/frontend/==.jpg)

上图中的`toPrimitive`就是对象转基本类型。

这里来解析一道题目`[] == ![] // -> true`，下面是这个表达式为何为`true`的步骤

```js
// [] 转成 true，然后取反变成 false
[] == false
// 根据第 8 条得出
[] == ToNumber(false)
[] == 0
// 根据第 10 条得出
ToPrimitive([]) == 0
// [].toString() -> ''
'' == 0
// 根据第 6 条得出
0 == 0 // -> true
```

### 比较运算符

1. 如果是对象，就通过`toPrimitive`转换对象
2. 如果是字符串，就通过`unicode`字符索引来比较
